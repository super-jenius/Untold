<!DOCTYPE html>
<html>

<head>
    <title>Untold Stories of The Secret World</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <!--<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="bootstrap.slate.min.css">
    <!-- Custom styles for this template -->
    <link href="untold.css" rel="stylesheet">
</head>

<body style="background-color:transparent;">

    <!--<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">UNTOLD STORIES OF THE SECRET WORLD</a>
            </div>
        </div>
    </nav>-->

    <a name="top"></a>

    <div class="container">

        <div style="text-align:right">
            <a href="#news" data-toggle="popover" title="Content News" data-content="The latest content for Untold Stories." data-trigger="hover" data-placement="left">Content News</a> //
            <a href="#settings" data-toggle="popover" title="Settings" data-content="Settings for Untold Stories." data-trigger="hover" data-placement="left">Settings</a> //
            <a href="#submissions" data-toggle="popover" title="Submit Missions/Lore" data-content="Learn how to submit missions and lore for Untold Stories." data-trigger="hover" data-placement="left">Submit Missions/Lore</a> //
            <a href="data:,localMissions" data-toggle="popover" title="Local Mission Launcher" data-content="Load and test missions from your local computer." data-trigger="hover" data-placement="left">Local Missions</a>
        </div>

        <div id="newVersion" class="alert alert-danger" role="alert" style="display: none;">
            <!--<a href="javascript:history.back()">Go Back</a>-->

            <ul>
                 <li id="version33">
                    <b>Version 3.3</b> is now available for download using the Curse Client or from SecretUI. This is a <b>RECOMMENDED</b> update and adds the following features:
                    <ul>
                        <li>Added a configuration attribute to the Looks tier, which now allows head type, hair style, eye tint, and facial hair to be set.</li>
                        <li>Added a ghost attribute to the Location tier. Mission authors can now require the player to be in ghost/anima form when going to a location.</li>
                    </ul>
                </li>
                <li id="version32"  style="display: none;">
                    <b>Version 3.2</b> is now available for download using the Curse Client or from SecretUI. This is a <b>RECOMMENDED</b> update and adds the following features:
                    <ul>
                        <li>Fixed an issue that prevented the timer from unloading after a PvP match or scenario.</li>
                    </ul>
                </li>
                <li id="version31" style="display: none;">
                    <b>Version 3.1</b> is now available for download using the Curse Client or from SecretUI. This is a <b>RECOMMENDED</b> update and adds the following features:
                    <ul>
                        <li>Documentation for mission authors of all new features added in version 3.0.</li>
                        <li>Support for meeehrUI-Topbar.</li>
                    </ul>
                </li>
                <li id="version30" style="display: none;">
                    <b>Version 3.0</b> is now available for download using the Curse Client or from SecretUI. This is a <b>REQUIRED</b> update and adds the following features:
                    <ul>
                        <li><b>Being Carter</b>, an all new mission, is now available to play. It demonstrates the new features added in version 3.0.</li>
                        <li>The new <b>Looks Tier</b> changes the appearance of the player or NPCs. The new look can be another NPC from the game (including major storyline characters), or one of your own design combining multiple looks and clothing. This tier can also be used during cinematics.</li>
                        <li>The new <b>Animation Tier</b> allows emotes and animations to be applied to the player or NPCS. This is great for cinematics!</li>
                        <li><b>Waypoints</b> can now be displayed when using the Location Tier. This requires an existing mission that uses a waypoint to be active. If one is not available, an old mission from Kingsmouth will be started automatically to enable the waypoint.</li>
                    </ul>
                </li>
            </ul>
        </div>

        <table class="table" >
            <thead>
                <tr>
                    <th>MISSION</th>
                    <th>STATUS</th>
                    <th>LORE-FRIENDLY*</th>
                    <th>AUTHOR</th>
                </tr>
            </thead>
            <tbody id="missionList"></tbody>
        </table>

        *Lore-Friendly: "Yes" indicates the author intended not to contradict the official lore of The Secret World. "No" means no such attempt was made, or that the content otherwise falls outside the official lore.

        <a name="news"></a>
        <div id="newsWell" class="alert alert-info" role="alert">
            <h4>Content News<a style="float:right" href="#top">^ Top</a></h4>
            <p>Added content does NOT require a new version of this MOD to be downloaded, unless you also see a new version announced above.</p>
            <p>
                <ul>
                    <li><b>Mar 4 2017:</b> New mission "Where Fools Fear to Tread Part 8" by Dorothy "Dots" Gale is now available (requires 3.0 or higher).</li>                   
                    <li><b>Dec 20 2016:</b> New mission "Where Fools Fear to Tread Part 7" by Dorothy "Dots" Gale is now available (requires 3.0 or higher).</li>                   
                    <li><b>Aug 27 2016:</b> New mission "Where Fools Fear to Tread Part 6" by Dorothy "Dots" Gale is now available (requires 3.0 or higher).</li>                   
                    <li><b>Jun 10 2016:</b> "The Shadow Out of Time - Revisited" by Tremerion is now available.</li>
                    <li><b>May 31 2016:</b> New mission "Where Fools Fear to Tread Part 5" by Dorothy "Dots" Gale and Nekhebit is now available (requires 3.0 or higher). Part 1 as also been updated.</li>
                    <li><b>Apr 24 2016:</b> New mission "Where Fools Fear to Tread Part 4" by Dorothy "Dots" Gale is now available (requires 3.0 or higher).</li>                   
                    <li><b>Apr 10 2016:</b> New mission "Where Fools Fear to Tread Part 3" by Dorothy "Dots" Gale is now available (requires 3.0 or higher).</li>
                    <li><b>Mar 29 2016:</b> New mission "Where Fools Fear to Tread Part 2" by Dorothy "Dots" Gale is now available (requires 3.0 or higher).</li>
                    <li><b>Feb 28 2016:</b> New mission "Where Fools Fear to Tread" by Dorothy "Dots" Gale is now available.</li>
                    <li><b>Feb 22 2016:</b> New mission "Being Carter" now available (requires 3.0 or higher).</li>
                    <li><b>Sep 3 2015:</b> Sprinkled lore of concept art, ARGs, and Twitterverses throughout The Secret World.</li>
                    <li><b>Jun 12 2015:</b> New mission "To The Church On Time" by Lilith Darkweaver is now available.</li>
                    <li><b>May 28 2015:</b> New mission "Akma's Hand" now available (requires 2.3 or higher).</li>
                    <li><b>Mar 21 2015:</b> Added FunCom Concept Art lore to London, New York, and Seoul.</li>
                    <li><b>Mar 15 2015:</b> Added more player artwork lore to all playfields.</li>
                    <li><b>Mar 7 2015:</b> Creating missions just got a whole lot easier! Solon has developed a very nice mission editor GUI (more info below). Thanks, Solon!</li>
                    <li><b>Mar 6 2015:</b> New mission "The Shadow Out of Time" by Tremerion.</li>
                    <li><b>Feb 28 2015:</b> Added artwork lore to Kingsmouth and The Savage Coast.</li>
                    <li><b>Feb 21 2015:</b> Version 2.2 added support for Panorama/Cinematic lore. I have placed three panoramas in Solomon Island, one in each zone (Kingsmouth, The Savage Coast, Blue Mountain). See if you can find them!</li>
                    <li><b>Feb 14 2015:</b> Untold Stories Lore was added with version 2.0. Kingsmouth was seeded with fan fiction.</li>
                </ul>
            </p>
        </div>

        <a name="settings"></a>
        <div id="worldWell" class="alert alert-success" role="alert" style="display: none;">
            <h4>Settings<a style="float:right" href="#top">^ Top</a></h4>
            <p>Untold Stories Lore highlights fan fiction, art, music, and video creations from the TSW community.  When you are near a designated location or character, a red US icon will appear in the notification area. Click the icon to open the lore.</p>
            <p id="disableWorld" style="display: none;"><a href="data:,worldStories=false">Disable Untold Stories Lore</a></p>
            <p id="enableWorld" style="display: none;"><a href="data:,worldStories=true">Enable Untold Stories Lore</a></p>
        </div>

        <a name="submissions"></a>
        <div class="well well-lg">
            <h4>Submit Missions<a style="float:right" href="#top">^ Top</a></h4>
            <p>If you create a mission, please send <a href="http://forums.thesecretworld.com/member.php?u=10486">Super Jenius</a> a private message on the TSW forums, and I will post your mission.</p>
            <p>You can now create missions using <a href="http://forums.thesecretworld.com/showthread.php?82855-MOD-Untold-Stories-of-The-Secret-World&p=1839764&viewfull=1#post1839764">Solon's mission editor</a> (outside the game) or with XML files. Documentation is included in \Data\Gui\Customized\Flash\Untold\Untold_Docs.pdf, located in the root of your The Secret World directory.</p>
            <p>Loading mission files from your local computer requires the Local Mission Launcher.  <a href="data:,localMissions">Click here to start it.</a></p>
            <h4>Submit Lore</h4>
            <p>To submit lore for inclusion, please refer to threads in the Fanpages &amp; Fanart section of the TSW forums.</p>
            <p><a href="http://forums.thesecretworld.com/showthread.php?84123-Get-your-creation-in-the-game!-%28Solomon-Island%29">Get your creation in the game!</a></p>
        </div>

        <div class="col-sm-6">
            Player Coordinates:
            <ul>
                <li>Playfield: <span id="playfield"></span></li>
                <li>X: <span id="x-coords"></span></li>
                <li>Y (height): <span id="y-coords"></span></li>
                <li>Z: <span id="z-coords"></span></li>
            </ul>
        </div>
        <div class="col-sm-6">
            Target Coordinates:
            <ul>
                <li>X: <span id="target-x-coords"></span></li>
                <li>Y (height): <span id="target-y-coords"></span></li>
                <li>Z: <span id="target-z-coords"></span></li>
            </ul>
        </div>

        <!--
                <form id="formtest" name="formtest" action="" method="get">
                    XML:
                    <br>
                    <textarea id="xml" name="xml" rows="30" cols="100"></textarea>
                </form>
         -->

    </div>
    <!-- /.container -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <!--	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <!-- Bootbox message box -->
    <script src="bootbox.min.js"></script>

    <script type='text/javascript'>
        $(document).ready(function () {
            listMissions();
            checkVersion();
            worldStories();
            showCoords();
            document.formtest.xml.value = qs["statusXML"];
        })

        var qs = (function (a) {
            if (a == "") return {};
            var b = {};
            for (var i = 0; i < a.length; ++i) {
                var p = a[i].split('=', 2);
                if (p.length == 1)
                    b[p[0]] = "";
                else
                    b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
            }
            return b;
        })(window.location.search.substr(1).split('&'));

        function checkVersion() {
            var version = qs["version"];
            if (version != "3.3") {
                $("#newVersion").show();
                if (version < "3.2") {
                    $("#version32").show();
                }
                if (version < "3.1") {
                    $("#version31").show();
                }
                if (version < "3.0") {
                    $("#version30").show();
                }
            }
        }

        function worldStories() {
            if (qs["worldStories"]) {
                $("#worldWell").show();
                if (qs["worldStories"] == "true") {
                    $("#disableWorld").show();
                } else {
                    $("#enableWorld").show();
                }
            }

        }

        function loadMission(missionID, missionFile) {
            try {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET", missionFile, false);
                xmlhttp.send();

                // encodeURI() seems to be more compatible with ActionScript 2 escape(), especially for special characters in other languages.
                var dataURL = 'data:,missionID=' + encodeURIComponent(missionID) + encodeURIComponent(xmlhttp.responseText);
                //var dataURL = 'data:,missionID=' + escape(missionID) + escape(xmlhttp.responseText);
                window.location = dataURL;
            } catch (err) {
                alert(err.message);
            }
        }

        function listMissions() {
            // Make sure launched within game
            if (qs["statusXML"]) {
                var missionList = new Array();
                if (qs["version"] >= "3.0") {
                    // Version 3.0 is a required update
                    missionList.push(["Basic Training", "BasicTraining", "BasicTraining.xml", "Status", "No", "Super Jenius", "A simple mission for demonstrating and testing the basic features of the system."]);
                    missionList.push(["Basic Training (German)", "BasicTrainingGerman", "BasicTrainingGerman.xml", "Status", "No", "Super Jenius", "A simple mission for demonstrating and testing the basic features of the system. This version will work with the German TSW client. However, mission text and dialog are still in English."]);
                    missionList.push(["A Personal Matter", "APersonalMatter", "APersonalMatter.xml", "Status", "Yes", "Super Jenius", "The Stationmaster has a personal request for you. This is an action mission with some light investigation elements."]);
                    missionList.push(["The Scroll", "TheScroll", "TheScroll.xml", "Status", "Yes", "Super Jenius", "A mysterious scroll has been discovered in the desert. This is a full investigation mission that will test your knowledge of The Secret World. Includes cinematics!"]);
                    missionList.push(["Undead Gratefulness", "UndeadGratefulness", "UndeadGratefulness.xml", "Status", "Yes", "Tremerion", "by Tremerion"]);
                    missionList.push(["Extraordinary Merchandise", "ExtraordinaryMerchandise", "ExtraordinaryMerchandise.xml", "Status", "Yes", "Tremerion", "by Tremerion"]);
                    missionList.push(["Echo Squad", "EchoSquad", "EchoSquad.xml", "Status", "Yes", "bluemoon", "by bluemoon"]);
                    missionList.push(["The Shadow Out of Time - Revisited", "TheShadowOutofTimeRevisited", "TheShadowOutofTimeRevisited.xml", "Status", "Yes", "Tremerion", "by Tremerion"]);
                    missionList.push(["Akma's Hand", "AkmasHand", "AkmasHand.xml", "Status", "Yes", "Super Jenius", "Delve into the mysteries and political intrigue surrounding Akma's Hand."]);
                    missionList.push(["To The Church On Time", "ChurchOnTime", "ChurchOnTime.xml", "Status", "Yes", "Lilith Darkweaver", "Lilith Darkweaver has a problem: her father promised her as a bride to a demon prince when she was a baby, and she's running out of time to find a way out of the contract. Finding out more about her father might yield a clue..."]);
                    missionList.push(["Being Carter", "BeingCarter", "BeingCarter.xml", "Status", "Yes", "Super Jenius", "You find yourself thinking about Carter. Pay her a visit at Innsmouth Academy. REQUIRES ACCESS TO TOKYO."]);
                    missionList.push(["Where Fools Fear to Tread", "WhereFoolsFearToTread", "Tarot1.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "The Fallen King holds court in London. He may have wisdom to share."]);
                    missionList.push(["Where Fools Fear to Tread Part 2", "WhereFoolsFearToTread2", "WhereFoolsFearToTread-Part2.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href=" http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "The Fallen King holds court in London. He may have wisdom to share once again."]);
                    missionList.push(["Where Fools Fear to Tread Part 3", "WhereFoolsFearToTread3", "Tarot3.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "The Fallen King has been helpful in getting you started so far. Maybe you should ask him again."]);
                    missionList.push(["Where Fools Fear to Tread Part 4", "WhereFoolsFearToTread4", "Tarot4.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "You are plagued with a few unanswered questions about The Wheel of Fortune and where the Fool's Journey leads next."]);
                    missionList.push(["Where Fools Fear to Tread Part 5", "WhereFoolsFearToTread5", "Tarot5.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "While you've learned about the Fool's Journey through the encounters you've had so far, you wonder if there's a library where you could look up a little more information *before* you run into Death...."]);
                    missionList.push(["Where Fools Fear to Tread Part 6", "WhereFoolsFearToTread6", "Tarot6.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "Where Fools Fear to Tread Part 6"]);
                    missionList.push(["Where Fools Fear to Tread Part 7", "WhereFoolsFearToTread7", "Tarot7.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "Where Fools Fear to Tread Part 7"]);
                    missionList.push(["Where Fools Fear to Tread Part 8", "WhereFoolsFearToTread8", "Tarot8.xml", "Status", "Yes", 'Dorothy "Dots" Gale (<a href="http://www.ambersandbox.com/dots_credits.htm">Credits</a>)', "Where Fools Fear to Tread Part 8"]);
                }

                // Sort according to status
                for (var i = 0; i < missionList.length; i++) {
                    var mission = missionList[i];
                    var status = getStatus(mission[1]);
                    mission.push(status);
                    if (status.lastIndexOf("In Progress", 0) === 0) {
                        mission.push(0);
                    }
                    else if (status.lastIndexOf("Complete", 0) === 0) {
                        mission.push(2);
                    }
                    else {
                        mission.push(1);
                    }
                }
                missionList.sort(function (a, b) {
                    return a[8] - b[8];
                });

                // Display missions in table
                var missionHTML = "";
                for (var i = 0; i < missionList.length; i++) {
                    var mission = missionList[i];
                    var popover = 'data-toggle="popover" title="' + mission[0] + '" data-content="' + mission[6] + '" data-trigger="hover"';
                    missionHTML += '<tr>\n';
                    missionHTML += '<td>' +
                        '<a href="#" ' + popover + ' onClick="loadMission(' + "'" + mission[1] + "','" +
                        mission[2] + "');" + '">' + mission[0] + '</a></td>\n';
                    missionHTML += '<td>' + mission[7] + '</td>\n';
                    missionHTML += '<td>' + mission[4] + '</td>\n';
                    missionHTML += '<td>' + mission[5] + '</td>\n';
                    //missionHTML += '<tr><td colspan="4" style="border-top: none">Mission Description will be listed here.</td></tr>\n';
                    missionHTML += '</tr>\n';
                }
            } else {
                // Launched outside of game
                missionHTML = "Mission list is only available from within The Secret World game.";
            }
            document.getElementById("missionList").innerHTML = missionHTML;
            $('[data-toggle="popover"]').popover();
        }

        var missionStatus = null;

        function getStatus(missionID) {
            // Parse XML first time called
            if (missionStatus == null && qs["statusXML"]) {
                var parser = new DOMParser();
                missionStatus = parser.parseFromString(qs["statusXML"], "text/xml");
                status = "First parse";
            }

            var tier = "";
            if (missionStatus) {
                var missions = missionStatus.getElementsByTagName("mission");
                for (var i = 0; i < missions.length; i++) {
                    if (missions[i].attributes.id.value.toUpperCase() == missionID.toUpperCase()) {
                        tier = missions[i].attributes.tier.value;
                        break;
                    }
                }
            }

            var status = "";
            switch (tier) {
                case "-99":
                    status = "Complete";
                    break;
                case "-1":
                case "":
                case undefined:
                    status = "";
                    break;
                default:
                    status = "In Progress";
                    break;
            }
            if (status != "") {
                status += ' <a href="#" onClick="resetMission(' + "'" + encodeURI(missionID) + "'" + ')">(Reset)</a>';
            }
            return status;
        }

        function resetMission(missionID) {
            bootbox.confirm("Do you want to reset your progress on the selected mission?", function (result) {
                if (result == true) {
                    window.location = "data:,resetMission=" + encodeURI(missionID);
                }
            });
        }

        function showCoords() {
            document.getElementById("playfield").innerHTML = qs["playfield"];
            document.getElementById("x-coords").innerHTML = qs["x"];
            document.getElementById("y-coords").innerHTML = qs["y"];
            document.getElementById("z-coords").innerHTML = qs["z"];
            document.getElementById("target-x-coords").innerHTML = qs["targetX"];
            document.getElementById("target-y-coords").innerHTML = qs["targetY"];
            document.getElementById("target-z-coords").innerHTML = qs["targetZ"];
        }
    </script>

</body>

</html>
